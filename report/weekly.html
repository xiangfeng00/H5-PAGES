<!DOCTYPE html>
<html class=" js-no-overflow-scrolling">
<head>
    <meta charset="utf-8">
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>学习周报</title>
    <link rel="stylesheet" type="text/css" href="../css/H5FullscreenPage.css">
    <link rel="stylesheet" href="../css/style-xxzb.css">
    <style>
        footer .logo {
            background: url(../../images/app_icon.png) no-repeat;
            background-size: 100%;
            width: 40px;
            height: 40px;
            margin: 10px 0px 7px 20px;
            border-radius: 8px;
            float: left;
        }
    </style>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
         style="display: none">
        <symbol id="wave">
            <path d="M420,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C514,6.5,518,4.7,528.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7c0,0,0,0,0,0v20H420z"></path>
            <path d="M420,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C326,6.5,322,4.7,311.5,2.7C304.3,1.4,293.6-0.1,280,0c0,0,0,0,0,0v20H420z"></path>
            <path d="M140,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C234,6.5,238,4.7,248.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7c0,0,0,0,0,0v20H140z"></path>
            <path d="M140,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C46,6.5,42,4.7,31.5,2.7C24.3,1.4,13.6-0.1,0,0c0,0,0,0,0,0l0,20H140z"></path>
        </symbol>
    </svg>

</head>
<body class="H5FullscreenPage">
<div class="H5FullscreenPage-wrap">

    <div class="item item1">
        <h2>学习周报</h2>
        <p><strong id="dateStr">&nbsp;</strong></p>
        <p class="dates"><span id="dateTime" style="min-width: 195px;">&nbsp;</span></p>
        <!--用户头像昵称-->
        <div class="user">
            <div class="user-heads"><img id="imgUser" src="../../images/widget_dface.png"></div>
            <div class="user-name" id="name"></div>
        </div>
        <div class="foot-text">“我很享受刷题的快感”</div>
        <!--app下载条-->
        <footer class="mui-bar mui-bar-footer " style="display: none">
            <div class="mui-row">
                <div class="col-xs-4">
                    <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.jeagine.cloudinstitute"
                       class="download">马上下载</a>
                </div>
                <div class="col-xs-1 logo"></div>
                <div class="col-xs-5 wz">
                    <h4 class="f16">毙考题 </h4>
                    <h7 class="f12">专为考试定制</h7>
                </div>
            </div>
        </footer>
    </div>

    <div class="item item2">
        <h2>学习概况</h2>
        <p>考试科目：<span id="cName"></span></p>
        <!--饼形统计图-->
        <div class="page" id="page">
            <div class="percent">
                <div class="percent__inner">
                    <div class="percent__num" id="beatCount">0</div>
                    <div class="percent__sign">
                        <b style="color:#46a8ec;" id="beatCount1"></b>
                        %
                    </div>
                </div>
            </div>
            <p class="button percent_text">你击败的考友</p>
            <div class="water" id="water">
                <svg class="water__wave water__wave_back" viewBox="0 0 560 20">
                    <use xlink:href="#wave"></use>
                </svg>
                <svg class="water__wave water__wave_front" viewBox="0 0 560 20">
                    <use xlink:href="#wave"></use>
                </svg>
            </div>
        </div>
        <!--学习情况-->
        <div class="xxqk">
            <p style="margin-bottom:12px;">本周学习情况</p>
            <ul class="kuang" id="testItems">
                <li style="">
                    <span id="testItemsSpan0">0</span>
                    <p>已掌握考点</p>
                </li>
                <li>
                    <span id="testItemsSpan1">0</span>
                    <p>基本掌握考点</p>
                </li>
                <li>
                    <span id="testItemsSpan2">0</span>
                    <p>刷题套数</p>
                </li>
            </ul>
        </div>
        <div class="foot-text">“越努力越幸运”</div>
        <!--app下载条-->
        <footer class="mui-bar mui-bar-footer " style="display: none">
            <div class="mui-row">
                <div class="col-xs-4">
                    <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.jeagine.cloudinstitute"
                       class="download">马上下载</a>
                </div>
                <div class="col-xs-1 logo"></div>
                <div class="col-xs-5 wz">
                    <h4 class="f16">毙考题 </h4>
                    <h7 class="f12">专为考试定制</h7>
                </div>
            </div>
        </footer>
    </div>

    <div class="item item3">
        <h2>排名变化</h2>
        <!--排名变化-->
        <div class="pmbh">
            <ul class="kuang">
                <li style=" border-right: 1px solid #d6d6d6;" id="ranking1">
                    <span><b>0</b>名</span>
                    <p>上周排名</p>
                </li>
                <li id="ranking2">
                    <span><b>0</b>名</span>
                    <p>本周排名</p>
                </li>
            </ul>
        </div>

        <!--排名折线图-->
        <div class="container" id="myChart">
            <span>排名</span>
            <b id="top"></b>
            <canvas id="canvas" height="180"></canvas>
        </div>

        <div class="foot-text">“这周，我拼尽了全力”</div>
        <!--app下载条-->
        <footer class="mui-bar mui-bar-footer " style="display: none">
            <div class="mui-row">
                <div class="col-xs-4">
                    <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.jeagine.cloudinstitute"
                       class="download">马上下载</a>
                </div>
                <div class="col-xs-1 logo"></div>
                <div class="col-xs-5 wz">
                    <h4 class="f16">毙考题 </h4>
                    <h7 class="f12">专为考试定制</h7>
                </div>
            </div>
        </footer>
    </div>

    <div class="item item4" id="fallibilityNameBox" style="display: none">
        <h2>易错考点</h2>
        <!--易错考点-->
        <div class="yckd">
            <ul class="kuang" id="fallibilityName">
                <!--<li><i>1、我是个好人</i></li>-->
                <!--<li><i>2、也是个坏人</i></li>-->
                <!--<li><i>3、对我坦诚只过是</i></li>-->
                <!--<li><i>4、对你认真，啊啦啦啦</i></li>-->
                <!--<li><i>5、我也是哥好人</i></li>-->
                <!--<li><i>6、为什么好人那个神</i></li>-->
                <!--<li><i>7、神到那么真，真可怕。</i></li>-->
                <!--<li><i>8、呵呵你是好人我就是神！</i></li>-->
            </ul>
        </div>
        <div class="foot-text">“永远走不完出题老师的套路”</div>
        <!--app下载条-->
        <footer class="mui-bar mui-bar-footer" style="display: none">
            <div class="mui-row">
                <div class="col-xs-4">
                    <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.jeagine.cloudinstitute" class="download"
                    >马上下载</a>
                </div>
                <div class="col-xs-1 logo"></div>
                <div class="col-xs-5 wz">
                    <h4 class="f16">毙考题 </h4>
                    <h7 class="f12">专为考试定制</h7>
                </div>
            </div>
        </footer>
    </div>

    <div class="item item5">
        <h2>本周成绩单</h2>
        <!--本周成绩单-->
        <div class="bzcjd-bk">
            <div class="bzcjd">
                <b class="b-1" style="display:none;">优秀</b>
                <b class="b-2" style="display:none;">良好</b>
                <b class="b-3" style="display:none;">合格</b>
                <b class="b-4" style="display:none;">不及格</b>
                <ul>
                    <li>
                        <span><f id="doQuestion">0</f>道</span>
                        <p>做题总数</p>
                    </li>
                    <li>
                        <span><f id="doQuestionRight">0</f>%</span>
                        <p>正确率</p>
                    </li>
                </ul>
                <ul class="ul-2">
                    <li>
                        <span><f id="testItemsSpan3">0</f>套</span>
                        <p>刷题套数</p>
                    </li>
                    <li>
                        <span><f id="doQuestionRightAvg">0</f>%</span>
                        <p>平均正确率</p>
                    </li>
                </ul>
            </div>
        </div>
        <!--app下载条-->
        <footer class="mui-bar mui-bar-footer " style="display: none">
            <div class="mui-row">
                <div class="col-xs-4">
                    <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.jeagine.cloudinstitute"
                       class="download">马上下载</a>
                </div>
                <div class="col-xs-1 logo"></div>
                <div class="col-xs-5 wz">
                    <h4 class="f16">毙考题 </h4>
                    <h7 class="f12">专为考试定制</h7>
                </div>
            </div>
        </footer>
    </div>
</div>
<script type="text/javascript" src="../js/zepto.min.js"></script>
<script type="text/javascript" src="../js/Chart.js"></script>
<script type="text/javascript" src="../js/H5FullscreenPage.js"></script>
<!--换屏-->
<script type="text/javascript">

    H5FullscreenPage.init({
        'type': 4, 'useMusic': false, 'pageShow': function (dom) {
        }, 'pageHide': function (dom) {
            //console.log(dom);
        }
    });

</script>
<script>
    function getRequest() {
        var url = window.location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    var Request = getRequest();

    var ua = navigator.userAgent.toLowerCase();
    function device() {
        if (/iphone|ipad|ipod/.test(ua)) {
            return "iOS";
        }
        if (/android/.test(ua)) {
            return "android";
        }
        return null;
    }
    $(function () {
        /**
         * 安卓的分享展示或者不展示
         */
        if (device() == "iOS") {
            try {
                window.webkit.messageHandlers.setShareButton.postMessage(false);
            } catch (e) {
                console.log(e);
            }
        } else if (device() == "android") {
            try {
                android.setShareButton(true);
            } catch (e) {
                console.log(e);
            }
        }
    });
    var appKey = Request.appKey;
    if (!/jeagine/.test(ua)) {
        $(".mui-bar-footer").show()
    }
    var dateStr = Request.dateStr;
    $("#dateStr").html(dateStr);
    var id = Request.id;
    function weekShareDialog() {
        var host = "http://" + window.location.host;
        var sinaIconUrl = host + "/images/sina_icon.png?r=" + Math.random();
        var iconUrl = host + "/images/app_icon_" + appKey + ".png?r=" + Math.random();
        var url = window.location.href;
        url = url.split("?")[0];
        var vote_title = "看我" + dateStr + "的毙考题学习成绩";
        var vote_subtitle = "越努力越幸运";
        var link = window.location.href;
        var data = {
            title: vote_title//主标题
            , subtitle: vote_subtitle//副标题
            , iconUrl: iconUrl//图标
            , sinaIconUrl: sinaIconUrl//新浪图标
            , link: link//分享链接
        };
        data = JSON.stringify(data);
        if (device() == "iOS") {
            try {
                window.webkit.messageHandlers.shareDialog.postMessage(data);
            } catch (e) {
                console.log(e);
            }
        } else if (device() == "android") {
            try {
                android.shareDialog(data);
            } catch (e) {
                console.log(e);
            }
        }
    }
    function toDecimal(x) {
        var f = parseFloat(x);
        if (isNaN(f)) {
            return false;
        }
        var f = Math.round(x * 100) / 100;
        var s = f.toString();
        var rs = s.indexOf('.');
        if (rs < 0) {
            rs = s.length;
            s += '.';
        }
        while (s.length <= rs + 2) {
            s += '0';
        }
        s = s.replace(".00", "");
        return s;
    }
    function setTime(dateList) {
        var arr = [];
        for (var j = dateList.length - 1; j >= 0; j--) {
            arr.push(dateList[j].split("-")[1] + "-" + dateList[j].split("-")[2]);
        }
        return arr;
    }
    function chartData(arr, everyDayStr) {
        var len = arr.length;
        var arrTemp = [];
        for (var i = 0; i < len; i++) {
            arrTemp.push(null);
        }
        var tempArr = [];
        if (everyDayStr != 0 && everyDayStr != null) {
            tempArr = everyDayStr.split(";");
        }

        for (var j = 0; j < tempArr.length; j++) {
            var arrT = parseInt(tempArr[j]);
            arrTemp[j] = arrT;
        }
        var returnArr = [];
        for (var j = arrTemp.length - 1; j >= 0; j--) {
            returnArr.push(arrTemp[j]);
        }
        return returnArr;
    }

    function toTop(arr) {
        var tempArr = [];
        for (var i = 0; i < arr.length; i++) {
            if (arr[i] != null && arr[i] != 0) {
                tempArr.push(arr[i]);
            }
        }
        if (tempArr.length == 0) return 0;
        return Math.min.apply(null, tempArr);
    }

    $.post("/api/user/report/get_report", {id: id}, function (data) {
        var obj = eval('(' + data + ')');
        console.log(obj);
        var bReportWeek = obj.bReportWeek;
        var labels = setTime(obj.dateList);
        var ChartData = chartData(labels, bReportWeek.every_day_str);
        showChart(labels, ChartData, 1);
        var top = toTop(ChartData);
        if (top != 0) {
            $("#top").html("最高排名第" + top + "名");
        }
        if (ChartData[0] == null) {
            $("#ranking1 span").html("无排名");
        }
        if (ChartData[0] != null) {
            $("#ranking1 span").html("第<b>" + ChartData[0] + "</b>名");
        }
        if (ChartData[7] != null) {
            $("#ranking2 span").html("第<b>" + ChartData[7] + "</b>名");
        }
        if (ChartData[7] == null) {
            $("#ranking2 span").html("无排名");
        }
        $("#dateTime").html(bReportWeek.date_time);
        var user_img = obj.user_img;
        if (user_img != null) {
            $("#imgUser").attr("src", user_img);
        }
        $("#name").html(obj.user_name);
        $("#cName").html(obj.cName);
        $("#testItemsSpan0").html(bReportWeek.mastered);
        $("#testItemsSpan1").html(bReportWeek.basic_grasp);
        var setOfQuestions = bReportWeek.module_exam + bReportWeek.set_exercises + bReportWeek.intelligent_exam;
        $("#testItemsSpan2").html(setOfQuestions);
        $("#testItemsSpan3").html(setOfQuestions);
        var beatCount = 0;
        if (bReportWeek.all_count != 0) {
            beatCount = toDecimal(bReportWeek.beat_count / bReportWeek.all_count * 100);
        }
        $("#beatCount").html(beatCount.split(".")[0]);
        if (beatCount.split(".").length > 1) {
            $("#beatCount1").html("." + beatCount.split(".")[1]);
        }
        var fallibility_name = bReportWeek.fallibility_name;
        if (fallibility_name != null) {
            $("#fallibilityNameBox").show();
            if (fallibility_name != 0) {
                var arr = fallibility_name.split(";");
                for (var i = 0; i < arr.length; i++) {
                    $("#fallibilityName").append("<li><i>" + (i + 1) + "、" + arr[i] + "</i></li>");
                }
            } else {
                $("#fallibilityName").html("<li><i>无易错考点！</i></li>")
            }
        }
        $("#doQuestion").html(bReportWeek.questions_all);
        var questionRight = 0;
        if (bReportWeek.questions_all != 0) {
            questionRight = toDecimal(bReportWeek.questions_right / bReportWeek.questions_all * 100);
            $("#doQuestionRight").html(questionRight);
        }
        if (parseFloat(questionRight) >= 90) {
            $(".b-1").show();
        }
        if (parseFloat(questionRight) < 90 && parseFloat(questionRight) >= 80) {
            $(".b-2").show();
        }
        if (parseFloat(questionRight) < 80 && parseFloat(questionRight) >= 60) {
            $(".b-3").show();
        }
        if (parseFloat(questionRight) < 60) {
            $(".b-4").show();
        }
        var doQuestionAll = parseFloat(bReportWeek.testitems_right_rate)
            + parseFloat(bReportWeek.testpaper_right_rate);

        if (setOfQuestions != 0) {
            $("#doQuestionRightAvg").html(toDecimal(doQuestionAll / setOfQuestions * 100));
        }
    });
</script>

<!--折线图-->
<script>
    function showChart(labels, data, scaleStepWidth) {
        var lineChartData = {
            // x轴的标示
            labels: labels,
            // 数据，数组中的每一个object代表一条线
            datasets: [
                {
                    // 颜色的使用类似于CSS，你也可以使用RGB、HEX或者HSL
                    // rgba颜色中最后一个值代表透明度
                    // 填充颜色
                    fillColor: "rgba(70, 168, 236, 0.5)",
                    // 线的颜色
                    strokeColor: "#d0e9fa",
                    // 点的填充颜色
                    pointColor: "#46A8EC",
                    // 点的边线颜色
                    pointStrokeColor: "#fff",
                    // 与x轴标示对应的数据
                    data: data
                }

            ]

        };
        var a = lineChartData.datasets[0].data, x, max = a[0];
        var s;
        for (x in a) {
            if (a[x] > max) {
                max = a[x];
            }
        }

        if (max > 100) {
            s = parseInt((max + 100) / 100) * 100;
        }
        else {
            s = 100;
        }
        var b = s / 5;

        var defaults = {

            //Boolean - If we show the scale above the chart data
            scaleOverlay: false,

            //Boolean - If we want to override with a hard coded scale
            scaleOverride: true,

            //** Required if scaleOverride is true **
            //Number - The number of steps in a hard coded scale
            scaleSteps: 5,

            //Number - The value jump in the hard coded scale
            scaleStepWidth: -b,

            // Y 轴的起始值
            scaleStartValue: s,

            // Y/X轴的颜色
            scaleLineColor: "#aaa",

            // X,Y轴的宽度
            scaleLineWidth: 0.5,

            // 刻度是否显示标签, 即Y轴上是否显示文字
            scaleShowLabels: true,

            // Y轴上的刻度,即文字
            scaleLabel: "<%= Number(value)+1%>",

            // 字体
            scaleFontFamily: "'Arial'",

            // 文字大小
            scaleFontSize: 12,

            // 文字样式
            scaleFontStyle: "normal",

            // 文字颜色
            scaleFontColor: "#666",

            // 是否显示网格
            scaleShowGridLines: false,

            // 网格颜色
            scaleGridLineColor: "rgba(0,0,0,.05)",

            // 网格宽度
            scaleGridLineWidth: 2,

            // 是否使用贝塞尔曲线? 即:线条是否弯曲
            bezierCurve: false,

            // 是否显示点数
            pointDot: true,

            // 圆点的大小
            pointDotRadius: 6,

            // 圆点的笔触宽度, 即:圆点外层白色大小
            pointDotStrokeWidth: 3,

            // 数据集行程
            datasetStroke: true,

            // 线条的宽度, 即:数据集
            datasetStrokeWidth: 2,

            // 是否填充数据集
            datasetFill: true,

            // 是否执行动画
            animation: true,

            // 动画的时间
            animationSteps: 60,

            // 动画的特效
            animationEasing: "easeOutQuart",

            // 动画完成时的执行函数
            onAnimationComplete: null

        }
        var withd = document.getElementById("myChart").offsetWidth;
        //获取父级的宽度
        document.getElementById("canvas").style.width = (withd - 50) + 'px' //赋宽度给canvas
        var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Line(lineChartData, defaults);

        //水圈高度
        //var water = document.getElementById('water'),
        //cnt = document.getElementById('beatCount'),
        //percent = cnt.innerHTML;
        //water.style.transform = 'translate(0, ' + (100 - percent) + '%)';

    }
</script>
</body>
</html>